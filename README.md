# QPRC

 ğŸš€ğŸš€ğŸš€è¿™æ˜¯ä¸€ä¸ªæ‰‹å†™RPCé¡¹ç›®ï¼Œç”¨äºå®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰é€šä¿¡ğŸš€ğŸš€ğŸš€

## ä¸€ã€é¡¹ç›®æ¶æ„

#### 1ã€æ¶æ„å’ŒåŸºæœ¬æµç¨‹

![image-20230809134419554](img/image-20230809134419554.png)



#### 2ã€åˆ†å±‚å’Œæ¨¡å—

![image-20230809134436884](img/image-20230809134436884.png)



## äºŒã€åŠŸèƒ½ç‰¹æ€§

- **ç®€å•çš„RPCæ¡†æ¶çš„å®ç°**ï¼šè¯¥RPCæ¡†æ¶å®ç°äº†åŸºæœ¬çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åŠŸèƒ½ï¼Œå…è®¸å®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œè°ƒç”¨è¿œç¨‹æœåŠ¡çš„æ–¹æ³•ï¼Œå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡å’Œåä½œã€‚
- **åŸºäºNettyçš„TCPçš„ç½‘ç»œé€šä¿¡åŸºæœ¬æœºåˆ¶**
  ï¼šRPCæ¡†æ¶ä½¿ç”¨Nettyä½œä¸ºåº•å±‚é€šä¿¡æ¡†æ¶ï¼Œåˆ©ç”¨Nettyæä¾›çš„å¼‚æ­¥éé˜»å¡IOç‰¹æ€§ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œä½¿ç”¨CompletableFutureç­‰æ–¹å¼å¤„ç†å¼‚æ­¥è¯·æ±‚å’Œç»“æœã€‚é€šè¿‡å¼‚æ­¥é€šä¿¡ï¼Œå¯ä»¥åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜æ€§èƒ½å’Œååé‡ã€‚
- **æœåŠ¡æ³¨å†Œä¸å‘ç°**ï¼šé€šè¿‡æ³¨å†Œä¸­å¿ƒ-ZooKeeperå®ç°ï¼šRPCæ¡†æ¶æ”¯æŒæœåŠ¡æ³¨å†Œä¸å‘ç°åŠŸèƒ½ï¼Œå°†æœåŠ¡æä¾›è€…çš„åœ°å€æ³¨å†Œåˆ°ZooKeeperæ³¨å†Œä¸­å¿ƒï¼Œå¹¶ç”±å®¢æˆ·ç«¯ä»æ³¨å†Œä¸­å¿ƒè·å–å¯ç”¨çš„æœåŠ¡æä¾›è€…åˆ—è¡¨ã€‚
- **å¤šç§åºåˆ—åŒ–/ååºåˆ—åŒ–ã€å‹ç¼©åè®®æ”¯æŒ**
  ï¼šRPCæ¡†æ¶æä¾›å¤šç§åºåˆ—åŒ–å’Œååºåˆ—åŒ–åè®®çš„æ”¯æŒï¼Œä¾‹å¦‚JSONã€Hessianç­‰ï¼Œä»¥é€‚åº”ä¸åŒåœºæ™¯ä¸‹çš„æ•°æ®ä¼ è¾“éœ€æ±‚ã€‚åŒæ—¶ï¼Œè¿˜æ”¯æŒæ•°æ®å‹ç¼©åè®®ï¼Œæœ‰æ•ˆå‡å°‘ç½‘ç»œä¼ è¾“çš„æ•°æ®é‡ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ã€‚
- **å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°**ï¼šRPCæ¡†æ¶æ”¯æŒè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯é€‰æ‹©åˆé€‚çš„æœåŠ¡æä¾›è€…ã€‚ç›®å‰æ”¯æŒè½®è¯¢ã€æœ€å°‘å“åº”æ—¶é—´ç­‰è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æœ€ä¼˜çš„ç­–ç•¥ã€‚
- **è¯·æ±‚è¶…æ—¶ä¸é‡è¯•æœºåˆ¶**
  ï¼šä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ï¼Œåœ¨RPCæ¡†æ¶ä¸­å®ç°äº†è¯·æ±‚è¶…æ—¶å’Œé‡è¯•æœºåˆ¶ã€‚å½“è¯·æ±‚è¶…è¿‡è®¾å®šçš„æ—¶é—´æœªå¾—åˆ°å“åº”æ—¶ï¼Œä¼šè¿›è¡Œè¶…æ—¶å¤„ç†ï¼Œé¿å…é•¿æ—¶é—´çš„ç­‰å¾…ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥è®¾ç½®é‡è¯•æ¬¡æ•°ï¼Œå½“è¯·æ±‚å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨è¿›è¡Œé‡è¯•ï¼Œæé«˜è¯·æ±‚æˆåŠŸç‡ã€‚
- **æœåŠ¡æ²»ç†èƒ½åŠ›**ï¼šRPCæ¡†æ¶æ”¯æŒä¸€å®šç¨‹åº¦çš„æœåŠ¡æ²»ç†èƒ½åŠ›ï¼Œä¾‹å¦‚å¿ƒè·³æ£€æµ‹å™¨ç”¨äºå®šæœŸæ£€æµ‹æœåŠ¡æä¾›è€…çš„å­˜æ´»æ€§ï¼Œå¹¶ç»´æŠ¤è¿æ¥æ± ã€‚æ­¤å¤–ï¼Œè¿˜æ”¯æŒæœåŠ¡çš„åŠ¨æ€æ·»åŠ å’Œç§»é™¤ï¼Œèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´æœåŠ¡åˆ—è¡¨ã€‚
  - é™æµå™¨ï¼šä¸ºäº†ä¿æŠ¤ç³»ç»Ÿèµ„æºï¼Œé˜²æ­¢è¿‡å¤šçš„è¯·æ±‚é€ æˆç³»ç»Ÿè¿‡è½½ï¼ŒRPCæ¡†æ¶æ”¯æŒé™æµå™¨åŠŸèƒ½ã€‚é€šè¿‡é™åˆ¶è¯·æ±‚çš„å¹¶å‘æ•°é‡æˆ–é€Ÿç‡ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶ç³»ç»Ÿçš„è´Ÿè½½ï¼Œä¿æŒç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚

  - ç†”æ–­å™¨ï¼šå½“æœåŠ¡æä¾›è€…å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨æ—¶ï¼Œç†”æ–­å™¨åŠŸèƒ½å¯ä»¥é¿å…æ— æ•ˆçš„è¯·æ±‚ç»§ç»­å‘é€ï¼Œè€Œæ˜¯åŠæ—¶ä¸­æ–­å¯¹è¯¥æœåŠ¡çš„è¯·æ±‚ã€‚è¿™æ ·å¯ä»¥å‡å°‘èµ„æºæµªè´¹ï¼Œå¹¶ä¿æŠ¤ç³»ç»Ÿå…å—æ•…éšœçš„å½±å“ã€‚
- **æ•´åˆSpring Boot**ï¼šRPCæ¡†æ¶å¯ä»¥ä¸Spring Bootè¿›è¡Œäº†é›†æˆï¼Œæ–¹ä¾¿åœ¨SpringBooté¡¹ç›®ä¸­ä½¿ç”¨RPCåŠŸèƒ½ã€‚å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ³¨è§£æˆ–é…ç½®æ¥æ³¨å†Œå’Œä½¿ç”¨RPCæœåŠ¡ï¼Œå¹¶å°†RPCæ¡†æ¶ä¸Spring Bootçš„å…¶ä»–åŠŸèƒ½æ— ç¼ç»“åˆã€‚
- **åŸºäºSPIæœºåˆ¶åŠ¨æ€åŠ è½½é…ç½®**ï¼šé€šè¿‡SPIï¼ˆService Provider Interfaceï¼‰æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥åŠ¨æ€åŠ è½½å’Œé…ç½®ä¸åŒçš„åŠŸèƒ½æ¨¡å—ï¼Œå®šåˆ¶åŒ–RPCæ¡†æ¶çš„è¡Œä¸ºã€‚ç”¨æˆ·è¿˜å¯ä»¥è‡ªå®šä¹‰å®ç°RPCçš„SPIï¼Œä»è€Œæ‰©å±•å’Œå®šåˆ¶æ¡†æ¶çš„åŠŸèƒ½ï¼Œå®ç°ä¸ªæ€§åŒ–éœ€æ±‚çš„é€‚é…ã€‚



## ä¸‰ã€å¿«é€Ÿå¼€å§‹

#### 1ã€å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°

```bash
https://github.com/red-velet/qrpc.git
```



#### 2ã€æ‰“å¼€é¡¹ç›®ç›®å½•

> æ ¹ç›®å½•-qrpc

- `qrpc-framework`ï¼šæœ€åŸå§‹çš„qrpcï¼Œæ²¡æœ‰é›†æˆspringbootï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®çš„commitè®°å½•ï¼ŒæŸ¥çœ‹æ¯ä¸€æ­¥çš„ç¼–å†™è¿‡ç¨‹ï¼Œä»è€Œå®ç°ä»é›¶äº†è§£ç¼–å†™qrpcçš„è¿‡ç¨‹è®°å½•ã€‚
  - `qrpc-core`ï¼šæ ¸å¿ƒåŒ…ï¼Œæ ¸å¿ƒä»£ç ã€‚
  - `qrpc-common`ï¼šå¸¸é‡ã€æšä¸¾ã€å¼‚å¸¸ã€å·¥å…·ç±»ç­‰å­˜æ”¾åœ°ã€‚
- `qrpc-starter/spring-boot-starter-qrpc`ï¼š
  - `qrpc-core`ï¼šè¯·å•ç‹¬æ‰“å¼€è¯¥æ¨¡å—ï¼Œå­˜æ”¾æ ¸å¿ƒä»£ç ï¼Œå¦‚éœ€ä½¿ç”¨è¯·ä½¿ç”¨mavenè¿›è¡Œinstallï¼Œç„¶åå¯¼å…¥å¯¹åº”åœ°å€å³å¯ã€‚
  - `springboot-qrpc-test`ï¼šè¯·å•ç‹¬æ‰“å¼€è¯¥æ¨¡å—ï¼Œæµ‹è¯•æ¨¡å—ï¼Œä¸¤ä¸ªspringbootçš„webé¡¹ç›®ç”¨ä½œæä¾›æ–¹å’Œè°ƒç”¨æ–¹ã€‚



#### 3ã€é¡¹ç›®é…ç½®

1. æœ¬åœ°installåï¼Œå¼•å…¥mavenåæ ‡ï¼š

   ```xml
   <dependency>
       <groupId>icu.chiou</groupId>
       <artifactId>spring-boot-starter-qrpc</artifactId>
       <version>1.0-SNAPSHOT</version>
   </dependency>
   ```

2. å¯ä»¥ä¿®æ”¹é…ç½®é¡¹ï¼šåœ¨å¯¹åº”springbootçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚`application.properties`ä¸­è¿›è¡Œè‡ªå®šä¹‰é…ç½®ï¼š

   ```properties
   server.port=8084
   qrpc.port=8094
   qrpc.serialize-type=json
   ```

   ![image-20230811231317705](img/image-20230811231317705.png)
   
3. å¦‚æœéœ€è¦è‡ªè¡Œé…ç½®ï¼Œè¯·å‚è€ƒï¼š

   ```java
   // è‡ªè¡Œé…ç½®spi,ç”¨æˆ·SPI,æ–‡ä»¶å:æ¥å£å,æ–‡ä»¶å†…å®¹:key=value
   private static final String DIY_LOADER = "META-INF/qrpc-diy/";
   
   // è‡ªè¡Œé…ç½®å‚æ•°é…ç½®æ–‡ä»¶
   qrpc.service-attachments.
   qrpc.client-attachments.
   ```

   

#### 4ã€æœåŠ¡å¼€å¯

æ³¨æ„ï¼š

- å¦‚éœ€ä½¿ç”¨æœåŠ¡ï¼Œéœ€è¦åœ¨é¡¹ç›®å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š`@EnableQRpcProvider`æˆ–è€… `@EnableQRpcConsumer`
- æä¾›æ–¹å’Œè°ƒç”¨æ–¹éƒ½éœ€è¦å®ç°ç¬¬ä¸‰æ–¹çš„ä¸€ä¸ªæ¥å£ã€‚
- å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒ`qrpc/qrpc-starter/spring-boot-starter-qrpc/springboot-qrpc-test`å†…çš„é¡¹ç›®æ¨¡å—ï¼ˆéœ€è¦å•ç‹¬æ‰“å¼€ï¼‰
  - apiï¼šåŒæ–¹éƒ½å®ç°çš„ä¸€ä¸ªæ¥å£
  - providerï¼šæœåŠ¡æä¾›æ–¹
  - comsumerï¼šæœåŠ¡è°ƒç”¨æ–¹



> **æœåŠ¡æä¾›æ–¹å¼€å¯é…ç½®**ï¼š

```java
@SpringBootApplication
@EnableQRpcProvider
public class ProviderApplication {
    public static void main(String[] args) {
        SpringApplication.run(ProviderApplication.class, args);
    }
}
```



> **æœåŠ¡è°ƒç”¨å¼€å¯é…ç½®**ï¼š

```java
@SpringBootApplication
@EnableQRpcConsumer
public class ConsumerApplication {
    public static void main(String[] args) {
        SpringApplication.run(ConsumerApplication.class, args);
    }
}
```



> **æœåŠ¡æä¾›æ–¹ä½¿ç”¨**ï¼š

```java
@QRpcApi
@RateLimiter(allMaxCapacity = 10, tokensPerReplenish = 10)
@Component
public class HelloServiceImpl implements HelloService {
    @Override
    public String say(String msg) {
        return "provider has receive your msg is -->" + msg;
    }
}
```



> **æœåŠ¡è°ƒç”¨æ–¹ä½¿ç”¨**ï¼š

```java
@RestController
public class HelloController {
    @QRpcService(loadBalancer = "roundRobin")
    @CircuitBreaker(allowMaxErrorRequest = 20, allErrorRate = 0.5f)
    HelloService helloService;


    @RequestMapping("hello")
    public String say() {
        say = helloService.say("hello ğŸ˜ŠğŸ˜ŠğŸ˜Š");
        say += "!!!";
        return say;
    }
}
```



#### 5ã€æ•ˆæœå›¾

![image-20230811233349696](img/image-20230811233349696.png)



## å››ã€APIæ–‡æ¡£

 æš‚æ— 
â€‹ è¯·å‚è€ƒ[APIæ–‡æ¡£](docs/API.md)äº†è§£æ›´å¤šå…³äºRPCæ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ä¸APIæ¥å£ã€‚



## äº”ã€è´¡çŒ®æŒ‡å—

 æ¬¢è¿æäº¤Issueæˆ–Pull Requestï¼Œæ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼ğŸ˜ŠğŸ˜ŠğŸ˜Š



## å…­ã€è”ç³»äº¤æµ

 å¦‚æœæ‚¨æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œè¯·å‘é€é‚®ä»¶è‡³bluebeastmight@gmail.comã€‚

 ä¸ªäººåšå®¢: www.chiou.icu



## ä¸ƒã€Star History

<a href="https://star-history.com/#red-velet/qrpc&Date">

  <picture>
    <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=red-velet/qrpc&type=Date&theme=dark" />
    <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=red-velet/qrpc&type=Date" />
    <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=red-velet/qrpc&type=Date" />
  </picture>
</a>
